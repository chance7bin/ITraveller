(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/plan/index"],{1130:function(t,e,n){"use strict";var i=n("87a6"),a=n.n(i);a.a},"2a85":function(t,e,n){"use strict";var i={"uni-search-bar":()=>n.e("components/uni-search-bar/uni-search-bar").then(n.bind(null,"0c60"))},a=function(){var t=this,e=t.$createElement;t._self._c},o=[];n.d(e,"b",function(){return a}),n.d(e,"c",function(){return o}),n.d(e,"a",function(){return i})},"2e6c":function(t,e,n){"use strict";(function(t){n("5df2"),n("921b");i(n("66fd"));var e=i(n("532f"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},"495b":function(t,e,n){"use strict";n.r(e);var i=n("5b60"),a=n.n(i);for(var o in i)"default"!==o&&function(t){n.d(e,t,function(){return i[t]})}(o);e["default"]=a.a},"532f":function(t,e,n){"use strict";n.r(e);var i=n("2a85"),a=n("495b");for(var o in a)"default"!==o&&function(t){n.d(e,t,function(){return a[t]})}(o);n("1130");var s,r=n("f0c5"),c=Object(r["a"])(a["default"],i["b"],i["c"],!1,null,"19c8f4d4",null,!1,i["a"],s);e["default"]=c.exports},"5b60":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(n("f28b"));function a(t){return t&&t.__esModule?t:{default:t}}var o=function(){return n.e("components/uni-search-bar/uni-search-bar").then(n.bind(null,"0c60"))},s={name:"index",data:function(){return{selectedSight:[],sightData:[],distanceMatrix:[],tempDistance:0,tempData:[],tempSight:[],sightObj:{},currentLocation:{},currentCity:"厦门市",bgColor:"#f5f6f7",inputValue:"",displayString:"",bestRoute:[],routeArr:[],isSuccess:!1,currentLat:"123"}},components:{uniSearchBar:o},onLoad:function(){},onShow:function(){this.getCurrentLocation(),console.log("currentLocation",this.currentLocation)},onPullDownRefresh:function(){t.showNavigationBarLoading(),t.authorize({scope:"scope.userLocation",success:function(){t.getLocation({type:"gcj02",success:function(e){console.log("当前位置的经度："+e.longitude),console.log("当前位置的纬度："+e.latitude),getApp().globalData.currentLat=e.latitude,getApp().globalData.currentLng=e.longitude,setTimeout(function(){t.request({url:"https://apis.map.qq.com/ws/geocoder/v1",data:{key:"L3LBZ-OQGE3-F3632-Y6Y3Z-2X7NS-CUBKT",location:e.latitude+","+e.longitude},success:function(e){getApp().globalData.currentCity=e.data.result.ad_info.city,t.stopPullDownRefresh(),t.hideNavigationBarLoading()}})},500)},fail:function(){console.log("request fail")}})},fail:function(){console.log("你拒绝了授权，无法获得周边信息")}}),this.getCurrentLocation(),this.currentLat=this.currentLocation.lat},methods:{listenInput:function(t){console.log(t),this.inputValue=t.value},showRoute:function(){0==this.routeArr.length?t.showModal({title:"提示",content:"暂无结果",showCancel:!1,confirmText:"确定"}):(getApp().globalData.acoRoute=this.routeArr,t.navigateTo({url:"showRoute"}))},selectItem:function(e){getApp().globalData.originAddress=e.origin,getApp().globalData.destinationAddress=e.destination,t.navigateTo({url:"../trip/toVehicle"})},getDistance:function(e,n){var i=this,a=e.no,o=n.no;t.request({url:"https://restapi.amap.com/v3/direction/driving",data:{key:"cb003321f848fc897f55ca40cf0e6b01",origin:e.lng+","+e.lat,destination:n.lng+","+n.lat,strategy:0},success:function(t){var e=t.data.route.paths[0].distance;i.distanceMatrix[a][o]=e}})},getDistanceMatrix:function(){this.distanceMatrix=[],console.log("getDistanceMatrix");for(var t=this.sightData.length,e=0;e<t;e++)this.distanceMatrix[e]=[];for(e=0;e<t;e++)for(var n=0;n<t;n++)this.getDistance(this.sightData[e],this.sightData[n])},getSightLocation:function(e,n,i){var a=this;t.request({url:"http://api.map.baidu.com/place/v2/search",data:{query:e,region:n,ak:"wRIcvin1aGUAAwXcM7tyRQwdZFyv9wnP",output:"json"},success:function(t){var e=t.data.results[0];a.sightObj={no:i+1,name:e.name,lat:e.location.lat,lng:e.location.lng,address:e.address},a.tempSight[i+1]=a.sightObj}})},buildSightData:function(){console.log("buildSightData"),this.tempSight=[];var t={no:0,name:"我的位置",lat:this.currentLocation.lat,lng:this.currentLocation.lng,address:"我的位置"};this.tempSight[0]=t;for(var e=0;e<this.selectedSight.length;e++)this.getSightLocation(this.selectedSight[e],this.currentCity,e);this.sightData=this.tempSight},getBestRoute:function(){this.isSuccess=!1;var e=this;this.distanceMatrix.length!=this.sightData.length?(t.showModal({title:"提示",content:"请求失败...请再试一次...",showCancel:!1,confirmText:"确定"}),t.hideLoading()):t.request({url:i.default.reUrl+"/Aco/CalculateBestRoute",data:{no:77,name:"app",array:this.distanceMatrix,arrLen:this.distanceMatrix.length},success:function(n){e.isSuccess=!0;var i=n.data;if(404!=n.data){t.showToast({title:"加载成功"});for(var a=[],o=0;o<i.length-1;o++)a.push(i[o]);var s=0;for(o=0;o<a.length;o++)1==a[o]&&(s=o);var r=[];for(o=s;o<a.length;o++)r.push(a[o]);for(o=0;o<s;o++)r.push(a[o]);e.bestRoute=r,t.hideLoading()}else e.isSuccess=!1,t.hideLoading(),t.showModal({title:"提示",content:"加载失败...请再试一次...",showCancel:!1,confirmText:"确定"})}})},displayResult:function(){this.routeArr=[];for(var t={},e=0;e<this.bestRoute.length-1;e++)t={origin:this.sightData[this.bestRoute[e]-1],destination:this.sightData[this.bestRoute[e+1]-1]},this.routeArr.push(t);t={origin:this.sightData[this.bestRoute[this.bestRoute.length-1]-1],destination:this.sightData[this.bestRoute[0]-1]},this.routeArr.push(t)},calculateRoute:function(){var e=this;this.selectedSight=this.inputValue.split(" "),""==this.inputValue?t.showModal({title:"提示",content:"请输入感兴趣的兴趣点",showCancel:!1,confirmText:"确定"}):(t.showLoading({title:"加载中..."}),console.log("calculateRoute"),this.buildSightData(),setTimeout(function(){e.getDistanceMatrix(),setTimeout(function(){e.getBestRoute(),setTimeout(function(){e.displayResult()},1e3)},3e3)},1e3))},getCurrentLocation:function(){this.currentLocation={lat:getApp().globalData.currentLat,lng:getApp().globalData.currentLng},this.currentCity=getApp().globalData.currentCity,this.currentLat=this.currentLocation.lat}}};e.default=s}).call(this,n("543d")["default"])},"87a6":function(t,e,n){}},[["2e6c","common/runtime","common/vendor"]]]);